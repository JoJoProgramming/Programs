import pandas as pd
import numpy as np
import SQLAlchemy as sql

userContract = input("What is your contract number?")
originalSubmission = pd.read_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Original Submission Amount.csv",skiprows=[0],usecols=[0,1,3,4,8,9,10,11,13],
                                    names=["Contract","Submission_ID","Pay_Period","Member_ID","Contribution_Type","Submission_Type","Submission_Amount",
                                            "MOF_Amount","Effective_Date"])
dfOriginal = pd.DataFrame(originalSubmission)
finalSubmission = pd.read_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Final Submission Amount.csv",skiprows=[0],usecols=[0,1,3,4,8,9,10,11,13],
                              names=["Contract","Submission_ID","Pay_Period","Member_ID","Contribution_Type","Submission_Type","Submission_Amount",
                                     "MOF_Amount","Effective_Date"])
dfFinal = pd.DataFrame(finalSubmission)
rawRecordkeeping = pd.read_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Recordkeeping.csv",skiprows=[0],usecols=[0,1,2,3,6,7,9],
                               names=["Contract","Member_ID","Effective_Date","Pay_Period",
                                      "Contribution_Type","Submission_Amount","Submission_ID"])
dfRecordkeeping = pd.DataFrame(rawRecordkeeping)
rawAccounting = pd.read_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Accounting.csv",skiprows=[0,1,2],
                            usecols=[7,9,10],names=["Effective_Date","MOF_Amount","Member_ID"])
dfAccounting = pd.DataFrame(rawAccounting)
dfAccounting["Contract"] = userContract
dfAccounting["Contribution_Type"] = "Loan Repayment"
dfRecordkeeping["Submission_Amount"] = pd.to_numeric(rawRecordkeeping["Submission_Amount"])
dfOriginal["Submission_Amount"] = pd.to_numeric(dfOriginal["Submission_Amount"])
dfOriginal["MOF_Amount"] = pd.to_numeric(dfOriginal["MOF_Amount"])
dfFinal["Submission_Amount"] = pd.to_numeric(dfFinal["Submission_Amount"])
dfFinal["MOF_Amount"] = pd.to_numeric(dfFinal["MOF_Amount"])
dfAccounting["MOF_Amount"] = pd.to_numeric(dfAccounting["MOF_Amount"])
parameters = ["Contract","Pay_Period","Member_ID","Contribution_Type","Effective_Date","Submission_ID"]
accountingParameters = ["Contract","Member_ID","Effective_Date","Contribution_Type"]
dfCompare = pd.merge(dfOriginal,dfFinal,on=parameters,how='outer')
dfCompare = pd.merge(dfCompare,dfRecordkeeping,on=parameters,how='outer')
dfCompare["Contract"] = pd.to_numeric(dfCompare["Contract"])
dfAccounting["Contract"] = pd.to_numeric(dfAccounting["Contract"])
dfCompare = pd.merge(dfCompare,dfAccounting,on=accountingParameters,how='outer')
#dfCompare columns:
#Contract	Submission_ID	Pay_Period	Member_ID	Contribution_Type	Submission_Type_x
#	Submission_Amount_x	MOF_Amount_x	Effective_Date	Submission_Type_y	Submission_Amount_y
#		MOF_Amount_y	Submission_Amount
# x df = Original. y df = Final. Submission_Amount = recordkeeping
dfCompare["Submission Comparison"] = dfCompare["Submission_Amount_x"] - (dfCompare["Submission_Amount_y"] +
                                                                         dfCompare["MOF_Amount_y"])
dfCompare["IPP Validations"] = np.where(dfCompare["Submission Comparison"].isnull(),"Y","N")
dfCompare["Submission_Amount_x"].fillna(0, inplace = True)
dfCompare["MOF_Amount_x"].fillna(0, inplace = True)
dfCompare["Submission_Amount_y"].fillna(0, inplace = True)
dfCompare["MOF_Amount_y"].fillna(0, inplace = True)
dfCompare["Submission_Amount"].fillna(0, inplace = True)
dfCompare["MOF_Amount"].fillna(0, inplace = True)
dfCompare["Submission vs Recordkeeping"] = (dfCompare["Submission_Amount_y"] +
                                           dfCompare["MOF_Amount_y"]) - (dfCompare["Submission_Amount"]+dfCompare["MOF_Amount"])
dfCompare = dfCompare[dfCompare["Submission vs Recordkeeping"] != 0]
dfFinalResult = pd.DataFrame()
dfFinalResult["Contract"] = dfCompare["Contract"]
dfFinalResult["Submission ID"] = dfCompare["Submission_ID"]
dfFinalResult["Member ID"] = dfCompare["Member_ID"]
dfFinalResult["Pay Period"] = dfCompare["Pay_Period"]
dfFinalResult["Effective Date"] = dfCompare["Effective_Date"]
dfFinalResult["Contribution Type"] = dfCompare["Contribution_Type"]
dfFinalResult["Original Submission Amount"] = dfCompare["Submission_Amount_x"]
dfFinalResult["Final Submission Amount"] = dfCompare["Submission_Amount_y"]
dfFinalResult["Final MOF Amount"] = dfCompare["MOF_Amount_y"]
dfFinalResult["IPP Validations"] = dfCompare["IPP Validations"]
dfFinalResult["Recordkeeping Amount"] = dfCompare["Submission_Amount"]
dfFinalResult["MOF Amount"] = dfCompare["MOF_Amount"]
dfFinalResult["Recordkeeping vs Submission"] = dfCompare["Submission vs Recordkeeping"]
dfCompare.to_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Raw Test.csv")
dfFinalResult.to_csv(r"C:\Users\khaaa\OneDrive\Desktop\Payroll Recon Python\Formatted Test.csv", index = False)
